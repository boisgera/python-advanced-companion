<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Fonctions</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!--
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"> 
  -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="stylesheet">
  <script>
      document.addEventListener("DOMContentLoaded", (event) => {
          let h3 = document.createElement("h3");
          h3.innerHTML = "Table des mati√®res";
          let toc = document.getElementById("TOC");
          toc.prepend(h3);
      });    
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Fonctions</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#fonctions">Fonctions</a>
<ul>
<li><a href="#d√©finitions">D√©finitions</a></li>
<li><a href="#valeurs-de-retour">Valeurs de retour</a></li>
<li><a href="#espaces-de-nom">Espaces de nom</a></li>
</ul></li>
<li><a href="#invocables">Invocables</a>
<ul>
<li><a href="#types">Types</a></li>
<li><a href="#m√©thodes">M√©thodes</a></li>
<li><a href="#instances">Instances</a></li>
</ul></li>
<li><a href="#fonctions-g√©n√©ratrices">Fonctions g√©n√©ratrices</a></li>
<li><a href="#programmation-fonctionnelle">Programmation fonctionnelle</a>
<ul>
<li><a href="#fonctions-lambda-ou-anonymes">Fonctions lambda (ou anonymes)</a></li>
<li><a href="#fermetures-de-fonctions">Fermetures (de fonctions)</a></li>
<li><a href="#d√©corateurs">D√©corateurs</a></li>
</ul></li>
</ul>
</nav>
<h2 id="fonctions">Fonctions</h2>
<h3 id="d√©finitions">D√©finitions</h3>
<p><code>def</code> <code>return</code>, retour r√©ifi√©s (tuple), arguments positionnels ou nomm√©s, arguments par d√©faut.</p>
<pre class="python"><code>def f(x, y, z=0):
    print(&quot;Please !&quot;)
    return 42</code></pre>
<p>Mentionner type hints (ex avec Typer ?).</p>
<h3 id="valeurs-de-retour">Valeurs de retour</h3>
<p><span class="math display">\[
\int_0^1 f(x) \, dx
\]</span></p>
<h3 id="espaces-de-nom">Espaces de nom</h3>
<p>Port√©e / scope</p>
<p>üá∫üá∏ ‚Üí Namespace</p>
<p>(implicites)</p>
<p>globals / locals (builtin module, read-only, etc.)</p>
<h2 id="invocables">Invocables</h2>
<p>On qualifie d‚Äôinvocable (ou appelable ; üá∫üá∏ : callable) tout objet se comportant comme une fonction, c‚Äôest-√†-dire pouvant √™tre appel√© (invoqu√©) avec la m√™me syntaxe que les fonctions.</p>
<p>Ainsi, l‚Äôentier <code>0</code> n‚Äôest pas invocable :</p>
<pre class="python"><code>&gt;&gt;&gt; zero = 0
&gt;&gt;&gt; zero()
TypeError: &#39;int&#39; object is not callable</code></pre>
<p>mais la fonction sans argument qui renvoie <code>0</code> est invocable :</p>
<pre class="python"><code>&gt;&gt;&gt; def zero_fun():
...     return 0
&gt;&gt;&gt; zero_fun()
0</code></pre>
<p>ce qui n‚Äôest pas une surprise puisque c‚Äôest une fonction !</p>
<pre class="python"><code>&gt;&gt;&gt; type(zero_fun)
&lt;class &#39;function&#39;&gt;
&gt;&gt;&gt; import types
&gt;&gt;&gt; isinstance(zero_fun, types.FunctionType)
True</code></pre>
<p>L‚Äôinvocabilit√© des objets Python peut √™tre test√©e avec la fonction <code>callable</code> :</p>
<pre class="python"><code>&gt;&gt;&gt; callable(zero)
False
&gt;&gt;&gt; callable(zero_fun)
True</code></pre>
<p>Notons que ce test permet de dire si un objet est invocable, mais pas si on peut l‚Äôinvoquer sans arguments (ni combien d‚Äôarguments sont n√©cessaires, de quel type, etc.). Ainsi :</p>
<pre class="python"><code>&gt;&gt;&gt; callable(hash)
True</code></pre>
<p>Mais</p>
<pre class="python"><code>&gt;&gt;&gt; hash()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: hash() takes exactly one argument (0 given)</code></pre>
<p>Toutefois</p>
<pre class="python"><code>&gt;&gt;&gt; hash(2**100)
549755813888</code></pre>
<p>Pour en savoir plus sur les arguments attendus, il faudra se reporter √† la documentation de l‚Äôobjet consid√©r√©.</p>
<h3 id="types">Types</h3>
<p>Un objet comme <code>int</code> est √©galement invocable :</p>
<pre class="python"><code>&gt;&gt;&gt; callable(int)
True</code></pre>
<p>ce que l‚Äôon peut rapidement confirmer exp√©rimentalement :</p>
<pre class="python"><code>&gt;&gt;&gt; int()
0
&gt;&gt;&gt; int(0.0)
0
&gt;&gt;&gt; int(&quot;0&quot;)
0</code></pre>
<p>Pourtant, ce n‚Äôest pas une function, mais un type :</p>
<pre class="python"><code>&gt;&gt;&gt; type(int)
&lt;class &#39;type&#39;&gt;
&gt;&gt;&gt; type(int) is type  # ü§Ø
True
&gt;&gt;&gt; isinstance(int, types.FunctionType)
False</code></pre>
<p>Rappelons que les types (ou classes) ont vocation, quand on les appelle, √† cr√©er des instances du type consid√©r√© :</p>
<pre class="python"><code>&gt;&gt;&gt; isinstance(int(), int)
True
&gt;&gt;&gt; isinstance(int(0.0), int)
True
&gt;&gt;&gt; isinstance(int(&quot;0&quot;), int)
True</code></pre>
<p>Les classes que vous d√©finissez sont √©galement invocables :</p>
<pre class="python"><code>class Transmogrifier:
    pass</code></pre>
<pre class="python"><code>&gt;&gt;&gt; callable(Transmogriphier)
True
&gt;&gt;&gt; transmogriphier = Transmogriphier()
&gt;&gt;&gt; isinstance(transmogriphier, Transmogrifier)
True</code></pre>
<h3 id="m√©thodes">M√©thodes</h3>
<p>Un <a href="https://calvinandhobbes.fandom.com/wiki/Transmogrifier">transmogriphieur</a> peut transformer son utilisateur en ce qu‚Äôil souhaite (par d√©faut, un tigre üêØ ; <a href="https://static.wikia.nocookie.net/candh/images/6/60/Tigercalvin.png/revision/latest?cb=20111208210956">mais on n‚Äôa pas sp√©cifi√© sa taille</a> !).</p>
<!-- not rendered on Github
![[Calvin transform√© en tigre](https://calvinandhobbes.fandom.com/wiki/Calvin_in_Tiger_Form_(Transmogrifier_alter_ego))](https://static.wikia.nocookie.net/candh/images/6/60/Tigercalvin.png/revision/latest?cb=20111208210956)
-->
<pre class="python"><code>class Transmogriphier:
    def __init__(self, turn_into=&quot;tiger&quot;):
        self.turn_into = turn_into
    def activate(self, user):
        return self.turn_into</code></pre>
<pre class="python"><code>&gt;&gt;&gt; transmogriphier = Transmogriphier()
&gt;&gt;&gt; transmogriphier.activate(&quot;calvin&quot;)
&#39;tiger&#39;</code></pre>
<p>L‚Äôop√©ration <code>transmogriphier.activate("calvin")</code> n‚Äôest pas ‚Äúatomique‚Äù : elle consiste d‚Äôabord √† obtenir l‚Äôattribut <code>activate</code> de l‚Äôobjet <code>transmogriphier</code>, puis √† l‚Äôinvoquer avec l‚Äôargument <code>"calvin"</code>.</p>
<pre class="python"><code>&gt;&gt;&gt; transmogriphy = transmogriphier.activate
&gt;&gt;&gt; callable(transmogriphy)
True
&gt;&gt;&gt; transmogriphy(&quot;calvin&quot;)
&#39;tiger&#39;</code></pre>
<p>Cela est possible car <code>activate</code> est une m√©thode (li√©e √† l‚Äôinstance <code>transmogriphier</code> de <code>Transmogriphier</code>) et est donc invocable.</p>
<pre class="python"><code>&gt;&gt;&gt; transmogriphy
&lt;bound method Transmogriphier.activate ...&gt;
&gt;&gt;&gt; type(transmogriphy)
&lt;class &#39;method&#39;&gt;
&gt;&gt;&gt; import types
&gt;&gt;&gt; type(transmogriphy) is types.MethodType
True</code></pre>
<h3 id="instances">Instances</h3>
<p>Notons qu‚Äô√† ce stade <code>Transmogriphier</code> est invocable et la m√©thode <code>activate</code> des transmogriphieurs √©galement. Mais les transmogriphieurs eux-m√™me ne le sont pas :</p>
<pre class="python"><code>&gt;&gt;&gt; callable(transmogriphier)
False</code></pre>
<p>Si nous estimons que c‚Äôest pr√©f√©rable, nous pouvons faire en sorte qu‚Äôils le deviennent. Il semble assez raisonnable de faire en sorte qu‚Äôinvoquer un transmogriphieur l‚Äôactive :</p>
<pre class="python"><code>class Transmogriphier:
    def __init__(self, turn_into=&quot;tiger&quot;)
        self.turn_into = turn_into
    def activate(self, user):
        return self.turn_into
    def __call__(self, user):
        return self.activate(user)</code></pre>
<pre class="python"><code>&gt;&gt;&gt; transmogriphier = Transmogriphier()
&gt;&gt;&gt; callable(transmogriphier)
True</code></pre>
<p>Nous pouvons alors simplifier l‚Äôusage du transmogriphieur de la fa√ßon suivante :</p>
<pre class="python"><code>&gt;&gt;&gt; transmogriphier(&quot;calvin&quot;)
&#39;tiger&#39;</code></pre>
<h2 id="fonctions-g√©n√©ratrices">Fonctions g√©n√©ratrices</h2>
<p>Une fonction est g√©n√©ratrice si sa d√©finition utilise le mot-cl√© <code>yield</code>.</p>
<ul>
<li><p>Appeler une fonction g√©n√©ratrice n‚Äôex√©cute pas son code imm√©diatement, mais fournit comme valeur de retour un it√©rateur.</p></li>
<li><p>Acc√©der au premier √©l√©ment de cet it√©rateur ex√©cute la fonction jusqu‚Äô√† atteindre le premier <code>yield</code> ; la fonction renvoie alors la valeur fournie au <code>yield</code>, puis pause son ex√©cution.</p></li>
<li><p>Acc√©der au second √©l√©ment de cet it√©rateur reprend le fil de l‚Äôex√©cution √† ce point, jusqu‚Äô√† atteindre le second <code>yield</code>, etc.</p></li>
</ul>
<p>Ainsi, avec</p>
<pre class="python"><code>def one_two_three():
    yield 1
    yield 2
    yield 3</code></pre>
<p>on obtient</p>
<pre class="python"><code>&gt;&gt;&gt; for i in one_two_three():
...     print(i)
1
2
3</code></pre>
<p>et</p>
<pre class="python"><code>&gt;&gt;&gt; list(one_two_three())
[1, 2, 3]</code></pre>
<h4 id="exemples-source-itertools">Exemples (source: <a href="https://docs.python.org/3/library/itertools.html#module-itertools">itertools</a>)</h4>
<pre class="python"><code>def count(start=0, step=1):
    &quot;&quot;&quot;
    Generate the sequence start, start + step, start + 2*step, ...
    &quot;&quot;&quot;
    value = start
    while True:
        yield value
        value += step</code></pre>
<p>Usage :</p>
<pre class="python"><code>&gt;&gt;&gt; odd_numbers = count(start=1, step=2)
&gt;&gt;&gt; for number in odd_numbers:
...     if number &gt;= 20:
...         break
...     else:
...         print(number, sep=&quot; &quot;)
1 3 5 7 9 11 13 15 17 19</code></pre>
<hr />
<pre class="python"><code>def cycle(iterable):
    &quot;&quot;&quot;
    Yield all items from an iterable, then repeat the same output sequence indefinitely. 
    &quot;&quot;&quot;
    items = list(iterable)
    if items:
        for item in items:
            yield item</code></pre>
<p>Usage :</p>
<pre class="python"><code>&gt;&gt;&gt; for i, item in enumerate(cycle(&quot;ABCD&quot;)):
...     if i &gt;= 12:
...         break
...     else:
...         print(item, sep=&quot; &quot;)
A B C D A B C D A B C D</code></pre>
<hr />
<pre class="python"><code>def repeat(object, n=None):
    &quot;&quot;&quot;
    Yield object an object n times (or indefinitely if n is None).
    &quot;&quot;&quot;
    if n is None:
        while True:
            yield object
    else:
        for i in range(n):
            yield object</code></pre>
<p>Usage :</p>
<pre class="python"><code>&gt;&gt;&gt; list(repeat(10, 3))
[10, 10, 10]</code></pre>
<h4 id="exercices">Exercices</h4>
<p>Impl√©mentez votre propre version des fonctions standards <code>range</code>, <code>enumerate</code> et <code>zip</code> en utilisant les fonctions g√©n√©ratrices.</p>
<h2 id="programmation-fonctionnelle">Programmation fonctionnelle</h2>
<p>Un des traits de la [programmation fonctionelle], un style de programmation que supporte (en partie) Python, est de permettre de manipuler les fonctions comme des objets comme les autres, pouvant √™tre d√©sign√© par une variable, stock√©s dans des conteneurs, pass√© comme arguments √† des fonctions, etc. Une fonction acceptant comme argument des fonctions et/ou en renvoyant est une fonction d‚Äôordre sup√©rieur.</p>
<p>Les librairies math√©matiques exploitent souvent avec profit ces fonctions d‚Äôordre sup√©rieures. Ainsi, la librairie de diff√©rentiation automatique <a href="https://github.com/HIPS/autograd#autograd---">Autograd</a> d√©finit une fonction d‚Äôordre sup√©rieure <code>grad</code> qui associe √† une fonction d‚Äôun argument r√©el sa d√©riv√©e :</p>
<p>Sa documentation donne l‚Äôexemple suivant d‚Äôusage :</p>
<pre class="python"><code>&gt;&gt;&gt; # Thinly-wrapped numpy
&gt;&gt;&gt; import autograd.numpy as np 
&gt;&gt;&gt; # The only autograd function you may ever need
&gt;&gt;&gt; from autograd import grad   
&gt;&gt;&gt; # Define a function
&gt;&gt;&gt; def tanh(x):                
...     y = np.exp(-2.0 * x)
...     return (1.0 - y) / (1.0 + y)
...
&gt;&gt;&gt; # Define a function
&gt;&gt;&gt; grad_tanh = grad(tanh)       
&gt;&gt;&gt; # Evaluate the gradient at x = 1.0
&gt;&gt;&gt; grad_tanh(1.0)               
0.41997434161402603
&gt;&gt;&gt; # Compare to finite differences
&gt;&gt;&gt; (tanh(1.0001) - tanh(0.9999)) / 0.0002
0.41997434264973155</code></pre>
<p>Un autre usage important des fonctions d‚Äôordre sup√©rieur est l‚Äôexploitation de <strong>fonctions de rappels</strong> (üá∫üá∏ : callbacks), notamment dans les interfaces graphiques.</p>
<p>Par exemple, regardons comment est programm√© l‚Äôapplication graphique donn√©e comme example dans <a href="http://tkdocs.com/tutorial/firstexample.html#design">le tutoriel de la biblioth√®que Tk</a>.</p>
<figure>
<img src="images/converter.png" alt="Convertisseur de pieds en m√®tres" /><figcaption aria-hidden="true">Convertisseur de pieds en m√®tres</figcaption>
</figure>
<p>L‚Äôinterface graphique est en partie d√©finie par le code :</p>
<pre class="python"><code>from tkinter import *
from tkinter import ttk

root = Tk()
root.title(&quot;Feet to Meters&quot;)

mainframe = ttk.Frame(root, padding=&quot;3 3 12 12&quot;)
mainframe.grid(column=0, row=0, sticky=(N, W, E, S))
root.columnconfigure(0, weight=1)
root.rowconfigure(0, weight=1)

feet = StringVar()
feet_entry = ttk.Entry(mainframe, width=7, textvariable=feet)
feet_entry.grid(column=2, row=1, sticky=(W, E))

meters = StringVar()
ttk.Label(mainframe, textvariable=meters).grid(column=2, row=2, sticky=(W, E))</code></pre>
<p>Retenons simplement √† ce stade que <code>root</code> est la fen√™tre principale de l‚Äôapplication, <code>feet</code> le champ de texte o√π nous rentrons la valeur de la longueur en pieds et <code>meters</code> le champ de texte qui devra afficher la longueur √©quivalent en m√®tres.</p>
<p>Pour que l‚Äôapplication se comporte comme voulu, nous d√©finissons une fonction <code>calculate</code> qui a chaque fois qu‚Äôelle est invoqu√©e, lit la longueur en pied et affiche la longeur en m√®tres :</p>
<pre class="python"><code>def calculate(*args):
    try:
        value = float(feet.get())
        meters.set(int(0.3048 * value * 10000.0 + 0.5)/10000.0)
    except ValueError:
        pass</code></pre>
<p>Puis nous cr√©ons un bouton qui rappelle cette fonction √† chaque fois qu‚Äôil est press√© :</p>
<pre class="python"><code>ttk.Button(
    mainframe, 
    text=&quot;Calculate&quot;, 
    command=calculate
).grid(column=3, row=3, sticky=W)</code></pre>
<p>Quelques labels de plus dans l‚Äôinterface graphique, un peu de positionnement, et nous sommes pr·∫øts √† lancer la boucle d‚Äôex√©cution du code !</p>
<pre class="python"><code>ttk.Label(mainframe, text=&quot;feet&quot;).grid(column=3, row=1, sticky=W)
ttk.Label(mainframe, text=&quot;is equivalent to&quot;).grid(column=1, row=2, sticky=E)
ttk.Label(mainframe, text=&quot;meters&quot;).grid(column=3, row=2, sticky=W)

for child in mainframe.winfo_children(): 
    child.grid_configure(padx=5, pady=5)

feet_entry.focus()

root.mainloop()</code></pre>
<pre class="python"><code>root.mainloop()</code></pre>
<h3 id="fonctions-lambda-ou-anonymes">Fonctions lambda (ou anonymes)</h3>
<p>Les fonctions lambda en Python sont une construction qui n‚Äôaugmente pas l‚Äôexpressivit√© du langage ‚Äì on ne peut rien faire avec des fonctions lambda qu‚Äôon ne pouvait d√©j√† faire avec les fonctions classiques ‚Äì mais permet dans certains cas d‚Äôobtenir un code plus concis.</p>
<p>Ainsi, pour trouver num√©riquement le z√©ro de la fonction <span class="math inline">\(x \mapsto x^2 - 2\)</span> entre <span class="math inline">\(0\)</span> et <span class="math inline">\(2\)</span> avec <code>scipy</code>, apr√®s avoir import√© une fonction de recherche de racines</p>
<pre class="python"><code>&gt;&gt;&gt; from scipy.optimize import root_scalar as find_root</code></pre>
<p>on peut d√©finir la fonction qui nous int√©resse, ce qui suppose de la nommer (par exemple <code>f</code>) :</p>
<pre class="python"><code>&gt;&gt;&gt; def f(x):
...     return x*x - 2</code></pre>
<p>puis appeler la routine de recherche de z√©ros de <code>scipy</code></p>
<pre class="python"><code>&gt;&gt;&gt; find_root(f, bracket=[0, 2])
      converged: True
           flag: &#39;converged&#39;
 function_calls: 9
     iterations: 8
           root: 1.4142135623731364</code></pre>
<p>Mais on peut aussi passer l‚Äô√©tape pr√©alable de d√©finition et de nommage de la function, et faire cet op√©ration √† la vol√©e, dans l‚Äôappel √† <code>find_root</code>, au moyen d‚Äôune fonction lambda :</p>
<pre class="python"><code>&gt;&gt;&gt; find_root(lambda x: x*x-2, bracket=[0, 2])
      converged: True
           flag: &#39;converged&#39;
 function_calls: 9
     iterations: 8
           root: 1.4142135623731364</code></pre>
<p>Le mot-cl√© <code>lambda</code> fait r√©f√©rence √† la notation traditionnelle du <a href="https://fr.wikipedia.org/wiki/Lambda-calcul"><span class="math inline">\(\lambda\)</span>-calcul</a>.</p>
<h3 id="fermetures-de-fonctions">Fermetures (de fonctions)</h3>
<blockquote>
<p>Dans un langage de programmation, une fermeture ou cl√¥ture (üá∫üá∏ : <em>closure</em>) est une fonction accompagn√©e de son environnement lexical.</p>
<p>L‚Äôenvironnement lexical d‚Äôune fonction est l‚Äôensemble des variables non locales qu‚Äôelle a captur√©es, soit par valeur (c‚Äôest-√†-dire par copie des valeurs des variables), soit par r√©f√©rence (c‚Äôest-√†-dire par copie des adresses m√©moires des variables).</p>
<p>Une fermeture est donc cr√©√©e, entre autres, lorsqu‚Äôune fonction est d√©finie dans le corps d‚Äôune autre fonction et utilise des param√®tres ou des variables locales de cette derni√®re.</p>
<p>Source : <a href="https://fr.wikipedia.org/wiki/Fermeture_(informatique)">Wikipedia</a></p>
</blockquote>
<h3 id="d√©corateurs">D√©corateurs</h3>
<p>Les d√©corateurs sont un ‚Äúsucre syntaxique‚Äù utilisant le symbole <code>@</code> et facilitant la mise en d‚Äôoeuvre d‚Äôun sch√©ma assez courant que nous allons illustrer sur un exemple.</p>
<p>Imaginons que nous ayons d√©velopp√© une fonction <code>plus_one</code></p>
<pre class="python"><code>def plus_one(x):
    return x + 1</code></pre>
<p>mais qu‚Äôen la testant dans un programme, nous trouvons son comportement myst√©rieux. Pour comprendre ce qui se passe, nous modifions sa d√©finition pour afficher ses arguments et les valeurs qu‚Äôelle renvoie √† chacun de ses appels.</p>
<pre class="python"><code>def plus_one(x):
    print(&quot;input:&quot;, x)
    y = x + 1
    print(&quot;output:&quot;, y)
    return y</code></pre>
<p>avec la ferme intention de retirer ce code suppl√©mentaire une fois le myst√®re √©clairci.</p>
<p>Ce proc√©d√© n‚Äôest toutefois pas tr√®s satisfaisant. Plut√¥t que de modifier le code de <code>plus_one</code>, nous pouvons d√©velopper une fonction <code>debug</code> qui prendra la fonction <code>plus_one</code> comme argument et renverra une nouvelle fonction qui fonctionne comme <code>plus_one</code> √† ceci pr√®s qu‚Äôelle affiche les arguments et la valeur de sortie :</p>
<pre class="python"><code>def debug(f):
    def f_debug(x):
        print(&quot;input:&quot;, x)
        y = f(x)
        print(&quot;output:&quot;, y)
        return y
    return f_debug</code></pre>
<p>Pour tester le code en situation r√©elle, il nous suffit alors de remplacer la fonction <code>plus_one</code> classique par cette nouvelle fonction</p>
<pre class="python"><code>plus_one = debug(plus_one)</code></pre>
<p>puis d‚Äôeffacer uniquement cette ligne suppl√©mentaire une fois le myst√®re √©clairci.</p>
<p>Il s‚Äôav√®re que le code</p>
<pre class="python"><code>def plus_one(x):
    return x + 1

plus_one = debug(plus_one)</code></pre>
<p>est √©quivalent √† la construction suivante utilisant les d√©corateurs :</p>
<pre class="python"><code>@debug
def plus_one(x):
    return x + 1</code></pre>
<p>On pourra trouver cette seconde notation plus agr√©able et lisible !</p>
<h4 id="exemples">Exemples</h4>
<p>Le d√©corateur <code>count</code> ci-dessous peut √™tre utilis√© pour enregistrer le nombre de fois o√π une fonction a √©t√© invoqu√©e (le nombre d‚Äôappels de la fonction est stock√© dans l‚Äôattribut <code>count</code> de la fonction).</p>
<pre class="python"><code>def count(f):
    def counted_f(x):
        counted_f.count += 1
        return f(x)
    counted_f.count = 0
    return counted_f</code></pre>
<p>Par exemple, si l‚Äôon recherche √† localiser l‚Äôunique z√©ro de la fonction <span class="math inline">\(x \mapsto x^2 - 2\)</span>, qui est <span class="math inline">\(\sqrt{2}\)</span>, on peut la d√©finir en la d√©corant avec la fonction d‚Äôordre sup√©rieur <code>count</code> :</p>
<pre class="python"><code>@count
def f(x):
    return x*x - 2</code></pre>
<p>Puis proc√©der par it√©rations successives pour produire une estimation de <span class="math inline">\(\sqrt{2}\)</span> :</p>
<pre class="python"><code>&gt;&gt;&gt; f(0)
-2
&gt;&gt;&gt; f(1)
-1
&gt;&gt;&gt; f(2)
2
&gt;&gt;&gt; f(1.5)
0.25
&gt;&gt;&gt; f(1.4)
-0.04000000000000026
&gt;&gt;&gt; f(1.45)
0.10250000000000004
&gt;&gt;&gt; f(1.43)
0.04489999999999972
&gt;&gt;&gt; f(1.42)
0.01639999999999997
&gt;&gt;&gt; f(1.41)
-0.011900000000000244</code></pre>
<p>Et constater √† posteriori combien d‚Äôappels de la fonction <code>f</code> ont √©t√© n√©cessaires :</p>
<pre class="python"><code>&gt;&gt;&gt; f.count
9</code></pre>
</body>
</html>
